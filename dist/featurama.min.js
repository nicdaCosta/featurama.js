/*! featurama.js - v0.0.8 - 2013-09-18
* https://github.com/nicdacosta/featurama.js
* Copyright (c) 2013 Nic da Costa; Licensed MIT */
window.featurama=function(e,t,n){"use strict";var r=t.head||t.getElementsByTagName("head")[0],o="featurama-",u=e.RSVP,s=function(e){var t=new u.Promise(function(t,r){var o=new XMLHttpRequest;o.open("GET",e),o.onreadystatechange=function(){return 4===o.readyState?200===o.status?t(o.responseText):r(Error(o.statusText)):n}});return t},a=function(e){var n=t.createElement("script");n.defer=!0,n.text=e,r.appendChild(n)},c=function(t,n){t=t||"key";var r=l({},n),u=typeof r.custom;r.custom="function"===u?"return ("+(""+r.custom)+")()":Array.isArray(r.custom)?"["+(""+r.custom)+"]":r.custom,e.localStorage.setItem(o+t,JSON.stringify(r))},i=function(t){t=t||"key";var n;try{var r=e.localStorage.getItem(o+t);n=JSON.parse(r||"false"),n.custom=n.custom?Function(n.custom):n.custom}catch(u){n=!1}return n},f=function(t){t=t||"key",e.localStorage.removeItem(o+t)},p=function(){var t,n,r=e.localStorage,u=[];for(t in r)n=t.split(o)[1],n&&u.push(n);return u},y=function(e){var t=e.key||"key",n=e.version||0,r=i(t),o=!0;return r&&(o=n!==r.version?!0:!1),o},l=function(e,t,r){e="object"==typeof e?e:{},t="object"==typeof t?t:{},r="boolean"==typeof r?r:!0;var o=Object.getOwnPropertyNames(t);return o.forEach(function(o){o=o,o&&t.hasOwnProperty(o)&&t[o]!==n&&(e[o]===n||r)&&(e[o]=t[o])}),e},g=function(t){t=t||"key";var r,o,u=d.config;return u!==n&&u.hasOwnProperty(t)&&u[t]!==n&&(r=u[t],r.regex instanceof RegExp?(r.regex.lastIndex=0,o=r.regex.test(e.navigator.userAgent)?r.result:n):r.regex instanceof Array&&r.regex.forEach(function(t){t instanceof RegExp&&(t.lastIndex=0,o=r.regex.test(e.navigator.userAgent)?r.result:n)})),o},h=function(e){e=e||"key";var t=d.config||{};t.hasOwnProperty(e)&&(t[e]=n)},m=function(e){e=e||"key";var t=d.results||{};t.hasOwnProperty(e)&&(t[e]=n)},v=function(t){t=t||"";var r=new u.Promise(function(r){e.Modernizr!==n?r(e.Modernizr.hasOwnProperty(t)?e.Modernizr[t]:!1):r(s("").then(function(e){return a(e),v(t)}))});return r},k=function(){for(var e,t=[],r=0,o=arguments.length,s=d.results;o>r;r++)e=arguments[r].key||"key",t.push(s.hasOwnProperty(e)&&s[e]!==n?new u.Promise(function(t){t(s[e])}):x(arguments[r]));return u.all(t)},x=function(e){var t,r=e.Modernizr||[],o=e.custom||[],s=typeof o,a=e.key||r[0]||"key",i=e.keepExisting!==n?e.keepExisting:!0,f=e.cacheTest!==n?e.cacheTest:!0,p=g(a),l=[],h=[];return f&&y(e)&&c(a,e),p!==n?h.push(p):(r.forEach(function(e){l.push(v(e))}),"function"===s?(p=o(),"object"==typeof p&&p.hasOwnProperty("_promiseCallbacks")?l.push(p):h.push(p)):o.forEach(function(e){"function"==typeof e&&(p=e(),"object"==typeof p&&p.hasOwnProperty("_promiseCallbacks")?l.push(p):h.push(p))})),t=l.length?u.all(l).then(function(e){return h=h.concat(e),E({key:a,results:h,keepExisting:i})}):E({key:a,results:h,keepExisting:i})},w=function(e){var t,r;return e=e!==n?e:"key",t=i(e),t?(t.cacheTest=!1,t.keepExisting=!1,r=x.call(null,t)):r=new u.Promise(function(e,t){t(Error("Test Does Not Exist"))}),r},E=function(e){var t,r=d.results,o=e.key||"key",s=e.keepExisting,a=e.results||[],c=!0;return t=new u.Promise(function(e){a.forEach(function(e){c=c&&e}),"object"!=typeof r&&(r={}),r[o]=r.hasOwnProperty(o)&&r[o]!==n&&s?r[o]:c,e(r[o])})},d={run:function(){var e;try{e=k.apply(null,arguments)}catch(t){}return e},rerun:function(e){var t=w(e);return t},remove:function(e){f(e),m(e),h(e)},clear:function(){var e=p();e.forEach(function(e){f(e)}),d.results={},d.config={}},exists:function(e){return i(e)?!0:!1},keys:function(){return p()},results:{},config:{}};return d}(window,document);